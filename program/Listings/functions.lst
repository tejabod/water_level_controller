C51 COMPILER V9.60.0.0   FUNCTIONS                                                         01/28/2023 19:40:59 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE FUNCTIONS
OBJECT MODULE PLACED IN .\Objects\functions.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE functions.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\functions.lst) TABS(2) OBJECT(.\Objects\functions.obj)

line level    source

   1          #include<header.h>
   2          
   3          extern unsigned int flow_count; 
   4          extern unsigned int hour;
   5          extern unsigned int minute;
   6          extern unsigned int second;
   7          
   8          
   9          unsigned int delay(unsigned int T_Secs)
  10            {
  11   1          unsigned int i =0;
  12   1          for (i =0;i<(T_Secs*1000)/50;i++)
  13   1          {
  14   2          TR0 =1;      // timer start
  15   2          while(TF0==0);  // check overflow condition
  16   2          TR0 =0;     // Stop Timer
  17   2          TF0 =0;    // Clear flag
  18   2          }
  19   1          return 1;
  20   1        }
  21              
  22            void Enable_SFR()
  23            {
  24   1          //init_uart
  25   1          SCON = 0x50;  // Asynchronous mode, 8-bit data and 1-stop bit
  26   1          TMOD = 0x21;  // Timer1 in Mode2 and Timer0 in Mode1
  27   1          TH1 =  0xFD;  // Load timer value for 9600 baudrate
  28   1          TR1 = 1;      // Turn ON the timer for Baud rate generation
  29   1          //init_uart
  30   1          
  31   1          ES  = 1;      // Enable Serial Interrupt
  32   1          P3 |= 0x0c;   // Configure the INT0 & INT1 pins as Inputs
  33   1          EX0 = 1;      // Enable INT0
  34   1          EX1 = 1;      // Enable INT1
  35   1          //    TH0 = 0x4B;   // Load timer value for 50ms
  36   1          //    TL0 = 0xFD;
  37   1          ET0 = 1;      // Enable Timer0 Interrupt
  38   1          TR0 = 1;      // Enable Timer1 Interrupt
  39   1          EA  = 1;      // Enable Global Interrupt bit will cause failure in compiler memory
  40   1          
  41   1          //T2MOD interrupts
  42   1          ET2 =1;  // enable external interrupt for counter 2 counter by T2 pin input
  43   1          C_T2 =1;   // select counter which 
  44   1      
  45   1          //timer registers
  46   1          TH0 = 0X4B;    //initial value for 50ms
  47   1          TL0 = 0XFD;
  48   1          // Counter 2 reg values which will increment with T2 pin
  49   1          TH2 = 0xFF;
  50   1          TL2 = 0xFD;
  51   1          //timer registers
  52   1          
  53   1          PS =1;      // set serial interrupt high priority
  54   1        }
C51 COMPILER V9.60.0.0   FUNCTIONS                                                         01/28/2023 19:40:59 PAGE 2   

  55            
  56            
  57          unsigned int check_flow()
  58            {
  59   1          flow_count = 0;
  60   1          EX0 = 1;      // Enable INT0
  61   1          P1_3 =1;         // keep open tap for water
  62   1            while(!delay(10))
  63   1            {
  64   2            while (!INT0);
  65   2            while (INT0);
  66   2            flow_count++;
  67   2            }
  68   1          EX0 = 0;      // Disble INT0
  69   1          P1_3 = 0;         // keep tap closed
  70   1          second=second+10;
  71   1          if(flow_count > 2)
  72   1          {
  73   2          return 1;
  74   2          }
  75   1          else
  76   1          {
  77   2            return 0;
  78   2          }
  79   1        }
  80          
  81          
  82          void increment_time() {
  83   1          second++;
  84   1          if (second == 60) {
  85   2              second = 0;
  86   2              minute++;
  87   2              if (minute == 60) {
  88   3                  minute = 0;
  89   3                  hour++;
  90   3                  if (hour == 24) {
  91   4                      hour = 0;
  92   4                  }
  93   3              }
  94   2          }
  95   1      }
  96          
  97          void turn_on_motor_at_6am() {
  98   1          // Check if it is 6am
  99   1          if (hour == 6 && minute == 0 && second == 0) 
 100   1            {
 101   2            if(check_flow())
 102   2            {
 103   3              EX1 = 1;
 104   3              while(!INT1)
 105   3              {
 106   4                increment_time();
 107   4                delay(1);
 108   4                P1_2 = 1;
 109   4              }
 110   3              EX1 = 0;
 111   3              P1_2 = 0;
 112   3            }
 113   2          }
 114   1      }


C51 COMPILER V9.60.0.0   FUNCTIONS                                                         01/28/2023 19:40:59 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    275    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
